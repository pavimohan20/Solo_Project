# Zeek Network Traffic Monitoring 

## 1. Install Zeek

### Installation on Kali Linux (via package manager)

The easiest way to install Zeek is by using the package manager.

Run the following commands to install Zeek on Kali Linux:

```bash
# Update your package list
sudo apt-get update

# Install Zeek
sudo apt-get install zeek
```

### Installing Zeek from Source

If you prefer to build Zeek from source, follow these steps:

#### Step 1: Install Dependencies

Before you can build Zeek from source, you need to install the necessary dependencies:

```bash
sudo apt-get install build-essential cmake libpcap-dev libssl-dev zlib1g-dev
```

#### Step 2: Download Zeek Source Code

You can download the latest version of Zeek from the official website or GitHub.

- **Official Zeek website**: [https://zeek.org/download/](https://zeek.org/download/)
- **Zeek GitHub repository**: [https://github.com/zeek/zeek](https://github.com/zeek/zeek)

Run the following commands to download Zeek from GitHub:

```bash
# Clone the Zeek repository
git clone https://github.com/zeek/zeek.git

# Navigate to the Zeek directory
cd zeek

# Checkout the latest stable release
git checkout master
```

#### Step 3: Build Zeek from Source

Now you can build Zeek using the following commands:

```bash
# Create a build directory
mkdir build
cd build

# Run cmake to configure the build
cmake ..

# Compile Zeek
make

# Install Zeek
sudo make install
```

This will install Zeek to the default location (`/usr/local/zeek`).

#### Step 4: Verify Installation

After installation, you can verify Zeek is installed by running:

```bash
zeek --version
```

---

## 2. Run Zeek to Monitor Traffic on the Chosen Interface

### List Available Network Interfaces

Before running Zeek, you need to know which network interfaces are available on your system. To list the available interfaces, use the following command:

```bash
ip a
```

This will show a list of network interfaces. For this challenge, we will use the `enp0s3` interface, which is the default network interface in most virtual machines.

### Start Zeek on the `enp0s3` Interface

To monitor live traffic on the `enp0s3` interface, run the following command:

```bash
sudo zeek -i enp0s3
```

Zeek will now start monitoring the traffic on the specified interface.

**Screenshot 1: Running Zeek on enp0s3 Interface**

![image](https://github.com/user-attachments/assets/42991367-d6af-4b9a-a60e-c9736a2da3ab)

```
## 3. Inspect the Logs Generated by Zeek

### List Generated Logs

Zeek generates log files in the current directory where it is run. To view the generated logs, use the `ls` command:

```bash
ls -l
```

Common log files generated by Zeek include `conn.log`, `http.log`, `dns.log`, etc. These logs are saved in the current directory where Zeek was run.

### Inspect `conn.log`

The `conn.log` file contains connection details like source and destination IPs, protocols, and bytes transferred. To inspect this file, use a text editor or a simple command like `less`:

```bash
less conn.log
```

Key fields in the `conn.log` file include:
- `ts`: Timestamp of the connection
- `id.orig_h`: The originating host IP address
- `id.resp_h`: The responding host IP address
- `proto`: The protocol used for the connection (e.g., ICMP, TCP, UDP)
- `duration`: Duration of the connection
- `orig_bytes`: Number of bytes sent by the origin host
- `resp_bytes`: Number of bytes sent by the responding host

**Screenshot 2: conn.log Example**

![image](https://github.com/user-attachments/assets/c5c3e1c4-bcca-495d-8413-a2ddfbb27e8d)


---

## 4. Explore Sample Scripts

Zeek comes with several sample scripts that demonstrate how to use Zeek's built-in functionality.

### Command to Explore Sample Scripts

Zeek scripts are located in the `/usr/share/zeek/scripts` directory. To explore the available scripts, run:

```bash
ls /usr/local/zeek/share/btest/scripts/
```

You can open any script for examination using a text editor, like this:

```bash
less /usr/local/zeek/share/btest/scripts/diff-sort
```

**Screenshot 3: Exploring Sample Zeek Scripts**
![image](https://github.com/user-attachments/assets/c78f246c-de6a-40fd-8b77-784d4a894479)

---

## 5. Create a Zeek Script

Let's create a simple Zeek script named `test-conn.zeek` to print a message when a new connection is established.

### `test-conn.zeek` Script:

```zeek
event zeek_init() {
    print "Zeek has started monitoring traffic.";
}

event connection_established(c: connection) {
    print fmt("New connection established: %s -> %s (%s/%s)",
        c$id$orig_h, c$id$resp_h, c$proto, c$state);
}
```

This script will print a message whenever a new connection is established.

## 6. Modify the Script to Log Connection Details

Modify the `test-conn.zeek` script to log connection details into a custom log file (`test-conn.log`).

### Modified `test-conn.zeek` Script:

```zeek
global log_file: string = "/usr/local/zeek/logs/test-conn.log";
@load base/protocols/conn
@load base/frameworks/logging

module TestConn;

export {

         # Define a unique Log::ID for this custom log
    redef enum Log::ID += { CUSTOM_CONN_LOG };

    # Define the log record
     type ConnLog: record {
        ts: time        &log;  # Timestamp
        uid: string     &log;  # Unique connection ID
        orig_h: addr    &log;  # Originating host IP
        orig_p: port    &log;  # Originating port
        resp_h: addr    &log;  # Responding host IP
        resp_p: port    &log;  # Responding port
    };
}

# Initialize the log stream correctly
#redef Log::default_logdir = "/usr/local/zeek/logs";

event zeek_init() {
     Log::create_stream(CUSTOM_CONN_LOG, [$columns=ConnLog, $path="test-conn"]);
}

event new_connection(c: connection) {
        Log::write(CUSTOM_CONN_LOG, [$ts=network_time(), $uid=c$uid,
                                     $orig_h=c$id$orig_h, $orig_p=c$id$orig_p,
                                     $resp_h=c$id$resp_h, $resp_p=c$id$resp_p]);
}




```

This script will write connection details into a custom log file and also print the details to the terminal.

**Screenshot 5: Modified `test-conn.zeek` Script**


![image](https://github.com/user-attachments/assets/d1898c20-2af8-4da0-874f-b68ed3fcc3d7)

---

## 7. Verify the Custom Log File Creation

After running the modified script, verify that the custom log file (`test-conn.log`) is created and contains the expected connection details.

### Run Zeek on a pcap File

Use a `.pcap` file to test the script. If you don't have a `.pcap` file, you can download sample files from Wireshark's [Sample Captures](https://www.wireshark.org/sample-captures/). Alternatively, use your own `.pcap` file.

To run Zeek on a `.pcap` file, use the following command:

```bash
sudo zeek -r /path/to/your/pcap/file /usr/local/zeek/test-conn.zeek
```

Replace `/path/to/your/pcap/file` with the actual path to the `.pcap` file.

### Check the Custom Log File

After running Zeek, you can check for the custom log file:

```bash
ls /usr/local/zeek/logs/test-conn.log
```

To view the log file:

```bash
less /usr/local/zeek/logs/test-conn.log
```

**Screenshot 6: test-conn.log File**


![image](https://github.com/user-attachments/assets/92f5fe1a-32c9-48f3-9a26-abfebf1a0e13)


---

## Conclusion

In this challenge, you have:

1. Installed Zeek on Kali Linux, both using the package manager and by building from source.
2. Monitored live traffic on the `enp0s3` network interface using Zeek.
3. Inspected connection logs (`conn.log`) to understand key fields.
4. Explored and created Zeek scripts to automate network monitoring.
5. Modified a Zeek script to log connection details to a custom log file.

By completing these steps, you now have a foundational understanding of how Zeek works and how to use it for network traffic analysis and monitoring.

---

## References

- [Zeek Official Documentation](https://docs.zeek.org/en/stable/)
- [Zeek GitHub Repository](https://github.com/zeek/zeek)
- [Wireshark Sample Captures](https://www.wireshark.org/sample-captures/)
```
